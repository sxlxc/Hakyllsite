---
title: Sudoku Matroids
author: Yu Cong
tags: matroid
lang: en
date: 2025-12-16
showtoc: true
---

In a 3×3 sudoku there are 9×9 cells and 3×9 constraints (9 rows, 9 columns and 9 blocks).
Given a filled sudoku, how many constraints are necessary to verify that the solution is correct?

<!--This is a note on Emil Jeřábek's answer in the mathoverflow link.-->

Refs:

- <https://matroidunion.org/?p=1070>
- <https://mathoverflow.net/questions/129143>

We need some sudoku notations.

```
       [3x3 sudoku]
      +---+---+---+
  +---+-B | B | B |  ← band 1 (each 3 rows)
  ↓   +---+---+---+
Block | B | B | B |  ← band 2
  ↑   +---+---+---+
  +---+-B | B | B |  ← band 3
      +---+---+---+
        ↑   ↑   ↑
          stacks (each 3 columns)
```

Note that a $n\times n$ sudoku contains $n$ bands, $n$ stacks and $n$ blocks. So there are $n^4$ cells and each cell can be filled with some number in $[n^2]$.

# matroid on constraint set

We will see that there is a matroid with constraints as its groundset.[^1]

Let $S$ be the set of constraints. Take a subset $T\subseteq S$ of constraints.
We say that $T$ **spans** a constraint $s\in S$ if every filled sudoku grid (with fixed dimension) satisfies $T$ also satisfies $s$. Then $\span_\#(T)$ is the maximal set of satisfied constraints if we check $T$.[^4]

::: {.Theorem #spanmatroid}
Let $S$ be a finite set. A function $\span:2^S\to 2^S$ is the span function of a matroid iff

(@1) $T\subseteq \span(T)$ for all $T\subseteq S$;
(@2) if $T,U\subseteq S$ and $U\subseteq \span(T)$, then $\span(U)\subseteq \span(T)$;
(@span) if $T\subset S, t\in S\setminus \span(T)$, and $s\in \span(T+t)\setminus \span(T)$, then $t\in \span(T+s)$.
:::

It follows immediately from the definition of our span function that (1.) and (2.) are satisfied.
We need to prove (@span).

Let's forget about matroids for now and try to understand why some constraints are not necessary.
A vague idea is that the sudoku grid structure comes with some information about the occurrence of the correctly filled numbers in some cells.

The definition of "satisfy" does not reveal information of the sudoku structure. To solve this issue, consider a linear mapping $\phi_G:S\to \Z^{n^2}$ for every filled sudoku grid $G$. For a cell $x\in S$, we define $\phi_G(x)$ to be an $n^2$ dimensional vector, which indicates the number of occurrence of each number in $[n^2]$. Then $x$ is satisfied by sudoku grid $G$ iff $\phi_G(x)=\mathbf 1$.

Note that our linear mapping $\phi$ works on linear combinations of $S$, so we slightly change its type to $\phi_G:V\to \Z^{n^2}$ where $V$ is the vector space generated by elements in $S$.[^3]
Consider vectors $\sum_{j\in [n]} r_{ij}$ (sum of rows in a band $i$) and $\sum_{j\in [n]} b_{ij}$ (sum of blocks in the same band). They cover exactly the same set of cells. So for any grid $G$, $\phi_G(\sum_{j\in [n]} r_{ij} - \sum_{j\in [n]} b_{ij})=0$. The same happens for columns and blocks in the same stack. We denote by $V_0$ the subspace of $V$ in which $\phi_G$ is $0$ for all grid $G$.

::: {.Lemma #lemspan}
Let $T\subset S$ be a set of constraints and let $s\notin T$ be a constraint.
Then $T$ spans $s$ in the sudoku if and only if $s\in \span(T\cup V_0)$ in the vector space $V$.[^2]
:::

::: Proof
Note that $T$ spans $s$ means that for any sudoku grid $G$ such that $\phi_G(t)=\mathbf 1$ for all $t\in T$, we have $\phi_G(s)=\mathbf 1$.

**[the if part]** Since $s\in \span(T\cup V_0)$, we can write $s$ as $\sum_i \alpha_i t_i+y$ where $t_i\in T$ and $y\in V_0$.
It follows from the linearity of $\phi$ that $\phi_G(s)=\sum_i \alpha_i \mathbf{1}+0$ holds for every grid satisfying $T$. Then we pick a correctly filled grid $G^*$.
One can see that $\mathbf{1}=\phi_G(s)= (\sum_i \alpha_i) \mathbf{1}$ which implies $\sum_i \alpha_i=1$.
Then we have $\phi_G(s)=1$.

**[the only if part]** Suppose by contradiction that $s\notin \span(T\cup V_0)$ and for every $G$ satisfying $T$ we have $\phi_G(s)=\mathbf 1$. We can write $s=\sum_i \alpha_i t_i + \sum_j \beta_j s_j+y$ where $s_j$'s are in the basis $S$ but not in the span.
Again there is a $G^*$ that satisfies every constraint and we have $\sum_i \alpha_i+\sum_j \beta_j=1$.
Now consider any grid $G$ that satisfies $T$.
We have $\phi_G(s)=\sum_i \alpha_i \mathbf{1} + \sum_j \beta_j s_j = \mathbf{1}$.
~~One can see that the equation holds if and only if every $s_j$ is $\mathbf 1$, which contradicts the fact that $s\notin \span(T+V_0)$.~~ [^5]
:::

Now we show (@span) in [@spanmatroid] for sudoku span.

::: {.Proof title="of (3)"}
It follows by [@lemspan] that $\span(T\cup V_0)\cap S = \span_\#(T)$ for $T\subset S$.
Note that $f(T)=\span(T\cup V_0)$ satisfies condition (@span).
It is easy to see that if $f(T)$ satisfies (@span) then $f(T)\cap S$ also satisfies (@span).
Then it follows that $\span_\#(T)$ is a span function of a matroid.
:::

# sudoku on graphs

We are going to play Sudoku on a class of connected graphs whose clique number $\omega(G)$ equals the chromatic number $\chi(G)$, and in which every edge belongs to some maximum clique.
For example, bipartite graphs, sudoku graphs and octahedron belong to this class.

Here are some graph classes that every edge belongs to some maximum clique:

- odd cycles. $\omega(G)\neq \chi(G)$
- bipartite graphs. $\omega(G)= \chi(G)$ and we have sudoku matroid on maximum cliques.
- sudoku graphs. $\omega(G)= \chi(G)$ and sudoku matroid ✓
- octahedron. $\omega(G)= \chi(G)$ and sudoku matroid ×

Is there a nice characterization of graphs that

1. $\omega(G)=\chi(G)$ and that
2. maximum cliques cover all edges?

## solvability

Let $G$ be a graph in which every edge is in a maximum clique. 
Let $H$ be the clique line graph of $G$, in which the vertex set is the set of maximum cliques and there are $k$-parallel edges if two cliques share $k$ vertices.

Note that one can also think about the uniform hypergraph of maximum cliques and see that $H$ is the [line graph of an uniform hypergraph](https://en.wikipedia.org/wiki/Line_graph_of_a_hypergraph).

There are some existing works on uniform hypergraph coloring.
Czumaj and Sohler [@czumaj_testing_2001] showed an $\e$-tester for $\ell$-colorability of $k$-uniform hypergraphs with running time $\exp(\tilde O(k\ell/\e)^2)$. 
Note that the definition of proper coloring on hypergraphs is no monochromatic hyperedge.

Our sudoku problem is equivalent to the following questions:

1. Whether a $k$-uniform hypergraph is *$k$-rainbow colorable*.
A hypergraph is $k$-rainbow colorable if there exists a vertex coloring using $k$ colors such that each hyperedge has all the $k$ colors. See [@guruswami_hardness_2018] and [@guruswami_rainbow_2020] for references. Another equivalent question is that if a given $k$-uniform hypergraph is $k$-partite.[^6]
2. Find the strong chromatic number $\gamma(H)$ of $k$-uniform hypergraphs. A coloring is strong if no color appears twice in the same hyperedge. (see [@agnarsson_strong_2005]) We want to check if $\gamma(H)=k$.

We try to characterize this subclass of $k$-uniform hypergraphs using line graphs.

::: Lemma
If $H$ is a tree, then $G$ is a perfect graph.
:::

::: Proof
$G$ is chordal.
:::

::: Lemma
If $H$ is bipartite, then $\omega(G)=\chi(G)$.
:::

::: Proof
Let $C$ be a maximum clique in $G$. There are maximum cliques sharing vertices with $C$. We write $S_i\subset C$ for the vertex intersections. One can see that if $S_i\cap S_j$ is nonempty then we will have a triangle in the clique line graph $H$.
So we assume $S_i$'s are disjoint since $H$ is bipartite.

Now consider an edge coloring of $H$ and recover from it a proper vertex coloring of $G$.
It follows from Kőnig's theorem that $H$ has an edge coloring using exactly $\Delta$ colors where $\Delta$ is the max degree in $H$. Note that each edge in $H$ corresponds to a shared vertex of two cliques.
We color the vertex with the same color as the corresponds edge in $H$.
Now the partial coloring is proper for each clique since colors are taken from a proper edge coloring.
Finally, one can see that for each maximum clique the number of uncolored vertices is exactly the number of unused colors, since $S_i$'s are disjoint.
:::

::: Remark
Bipartite $H$ covers octahedron and even cycles but not sudoku graphs.
:::

First we need to find a nice characterization of line graph or something else that covers sudoku graphs but excludes odd cycles.
I guess there should be some connections in group theory.
The plan is to try graph classes in [Graph families defined by their automorphisms](https://en.wikipedia.org/wiki/Graph_automorphism#Graph_families_defined_by_their_automorphisms).
Note that regular graphs, vertex-transitive graphs and Cayley graphs won't work.

## integral, Cayley and NEPS

[Sudoku graphs](https://en.wikipedia.org/wiki/Sudoku_graph) are [integral](https://en.wikipedia.org/wiki/Integral_graph) [Cayley](https://en.wikipedia.org/wiki/Cayley_graph) graphs.

I guess integral might be a key property to separate odd cycles and sudoku graphs, since the only integral odd cycle is $C_3$ which does not contradict the $\chi=\omega$ condition.

### integral & NEPS

Torsten Sander [@Sander_2009] proved that sudoku graphs are integral.
By integral it means that the eigenvalues of the adjacency matrix are all integral.

Sander's proof basically shows that sudoku graphs are NEPS of four complete graphs and then uses a existing theorem on eigenvalues of NEPS.
Given a set $B\subset \set{0,1}^n-\mathbf 0$ and graphs $G_1,\ldots,G_n$, the non-complete extended $p$-sum (NEPS) of these graphs with respect to basis $B$ is the graph $G$ with vertex set $V(G)=V(G_1)\times \dots \times V(G_n)$ and edge set $E(G)$ such that $(x_1,\ldots,x_n),(y_1,\ldots,y_n)\in V(G)$ are adjacent iff there exists some $n$-tuple $(b_1,\ldots,b_n)\in B$ such that $x_i=y_i$ whenever $b_i=0$ and $x_i,y_i$ are adjacent in $G_i$ whenever $b_i=1$.

::: Lemma
Let $n\geq 2$ be an integer and $G_1,\ldots,G_4=K_n$.
If $G$ is the NEPS of $G_i$ for basis
\begin{equation*}
\begin{aligned}
  B=\{&(0,0,0,1),\\
   &(0,0,1,0),\\ 
   &(0,1,0,0),\\ 
   &(1,0,0,0),\\ 
   &(0,1,0,1),\\ 
   &(1,1,0,0),\\ 
   &(0,0,1,1)\}
\end{aligned}
\end{equation*}
then $G$ is a sudoku graph.
:::

See Figure 3 in [@Sander_2009] for the proof.

### Cayley

Let $G$ be a group and let $S$ be a generating set of $G$. The Cayley graph $\Gamma(G,S)$ is a directed regular graph in which the vertices are the elements in $G$ and there is an edge from $u$ to $su$ with label $s$ for every $s\in S$.

A sudoku graph with $n^2\times n^2$ vertices is a Cayley graph of the abelian group $Z_n^4$.
(Sudoku graphs are undirected. Consider a bi-directional edge undirected.)
There's a one-to-one mapping from every vertex in sudoku graph (every cell in sudoku grid) to $Z_n^4$.
The tuple $(a,b,c,d)$ indexes the vertex in the $a$-th band, $b$-th row in that band, $c$-th stack and $d$-th column in that stack.(assuming numbers are 0-indexed.)
Then the generating set is
\begin{equation*}
\begin{aligned}
S   &=    \{(0,0,0,x),\forall x\in Z_n\}\\
    &\cup \{(0,0,x,0),\forall x\in Z_n\}\\
    &\cup \{(0,x,0,0),\forall x\in Z_n\}\\
    &\cup \{(x,0,0,0),\forall x\in Z_n\}\\
    &\cup \{(0,x,0,y),\forall x,y\in Z_n\}\\ 
    &\cup \{(x,y,0,0),\forall x,y\in Z_n\}\\ 
    &\cup \{(0,0,x,y),\forall x,y\in Z_n\}\\ 
\end{aligned}
\end{equation*}

Now one can see that each tuple in the basis of NEPS corresponds to a pattern of elements in generating set.

## matroid on maximum cliques

...

[^1]: The idea is from the joint work of authors in the mathoverflow question. I think this is a simpler and more intuitive proof.

[^2]: Note that $\span(T\cup V_0)$ is the subspace of $V$ spanned by vectors in $T\cup V_0$.

[^3]: Later we will see that $S$ is not linearly independent and thus is not a base of $V$.

[^4]: We will work on vector spaces. To avoid confusions we use $\span_\#$ for sudoku span function and use $\span$ for the span function in vector spaces and matroids.

[^5]: This requires some properties of the [sudoku graph](https://en.wikipedia.org/wiki/Sudoku_graph) and does not hold for all perfect graphs. See the $K_{2,2,2}$ example in the matroid union post.

[^6]: I guess there should be some papers showing that it's NP-complete to decide if a  $k$-uniform hypergraph is $k$-partite. haven't found one.